# Betting System

Это система для приема ставок на события, состоящая из двух сервисов:

- **line-provider**: Предоставляет информацию о событиях.
- **bet-maker**: Принимает ставки на события от пользователей.

## Содержание

- [Требования](#требования)
- [Установка и запуск](#установка-и-запуск)
- [API](#api)
- [Использование](#использование)
- [Завершение работы](#завершение-работы)

## Требования

- Docker
- Docker Compose

## Установка и запуск

1. **Клонируйте репозиторий** или скопируйте файлы проекта в директорию.

2. **Перейдите в корневую директорию проекта** и выполните команду для запуска
   основных сервисов:

    ```bash
    make up
    ```

   Эта команда соберёт образы и запустит сервисы `db`, `line_provider`
   и `bet_maker`.

## API

### line-provider

- `GET /health`: Проверка состояния сервиса.
- `GET /events`: Получить список всех событий.
- `GET /event/{event_id}`: Получить информацию о конкретном событии.
- `POST /event`: Создать новое событие.
- `PUT /event/{event_id}`: Обновить событие.

### bet-maker

- `GET /health`: Проверка состояния сервиса.
- `GET /events`: Получить список событий, доступных для ставок.
- `POST /bet`: Совершить ставку на событие.
- `GET /bets`: Получить историю всех ставок.

## Использование

Для удобного взаимодействия с API, вы можете открыть автоматически сгенерированную FastAPI документацию по следующим адресам:

- [http://localhost:8001/docs](http://localhost:8001/docs) для сервиса `line-provider`
- [http://localhost:8002/docs](http://localhost:8002/docs) для сервиса `bet-maker`
#### там же можно попробовать выполнить запросы к API.

### Получение списка событий

```bash
curl http://localhost:8001/events
```

### Совершение ставки

```bash
curl -X POST http://localhost:8002/bet -H "Content-Type: application/json" -d '{
    "event_id": "1",
    "amount": 100.00
}'
```

### Получение списка ставок

```bash
curl http://localhost:8002/bets
```

### Обновление статуса события

```bash
curl -X PUT http://localhost:8001/event/1 -H "Content-Type: application/json" -d '{
    "event_id": "1",
    "coefficient": 1.20,
    "deadline": 9999999999,
    "status": "FINISHED_WIN"
}'
```

После обновления статуса события, подождите некоторое время (около 10 секунд)
и проверьте обновленный статус ставки:

```bash
curl http://localhost:8002/bets
```

## Завершение работы

Чтобы остановить и удалить все контейнеры, выполните команду:

```bash
make down
```


## Дополнительная информация

- **Асинхронность**: Все взаимодействия между сервисами и базой данных
  реализованы асинхронно.
- **Хранилище ставок**: Ставки сохраняются в базе данных PostgreSQL с
  использованием асинхронного SQLAlchemy.
- **Docker и Docker Compose**: Все сервисы докеризированы и могут быть
  запущены с помощью Docker Compose.
- **PEP8 и type hints**: Код следует стандарту PEP8 и использует аннотации
  типов.
- **Фоновые задачи**: В `bet-maker` реализована фоновая задача для обновления
  статусов ставок.

